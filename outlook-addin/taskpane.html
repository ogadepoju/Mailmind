<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MailMind</title>
<script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;600&family=Syne:wght@700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #12121a;
    --border: #1e1e2e;
    --accent: #00e5ff;
    --green: #10b981;
    --amber: #f59e0b;
    --red: #ef4444;
    --text: #e2e8f0;
    --muted: #64748b;
    --subtle: #334155;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    height: 100vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  /* ‚îÄ‚îÄ‚îÄ PIN BANNER ‚îÄ‚îÄ‚îÄ */
  #pin-banner {
    background: linear-gradient(135deg, rgba(0,229,255,0.08), rgba(124,58,237,0.08));
    border-bottom: 1px solid rgba(0,229,255,0.2);
    padding: 10px 12px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
    flex-shrink: 0;
    animation: mm-slidein 0.4s ease;
  }

  @keyframes mm-slidein {
    from { opacity: 0; transform: translateY(-8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .pin-icon {
    font-size: 18px;
    flex-shrink: 0;
    margin-top: 1px;
  }

  .pin-text { flex: 1; }

  .pin-title {
    font-size: 11px;
    font-weight: 600;
    color: var(--accent);
    margin-bottom: 3px;
  }

  .pin-desc {
    font-size: 10px;
    color: var(--muted);
    line-height: 1.6;
  }

  .pin-desc strong { color: var(--text); }

  .pin-dismiss {
    background: rgba(0,229,255,0.1);
    border: 1px solid rgba(0,229,255,0.25);
    border-radius: 5px;
    color: var(--accent);
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 600;
    padding: 4px 10px;
    cursor: pointer;
    flex-shrink: 0;
    margin-top: 2px;
    transition: all 0.15s;
  }

  .pin-dismiss:hover {
    background: rgba(0,229,255,0.2);
  }

  /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
  .header {
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
    background: #070710;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
  }

  .header-left { display: flex; align-items: center; gap: 10px; }

  .logo {
    width: 32px; height: 32px;
    background: linear-gradient(135deg, #0a0a0f, #1a1a2e);
    border: 1px solid var(--accent);
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; color: var(--accent);
    box-shadow: 0 0 12px rgba(0,229,255,0.2);
  }

  .brand-name {
    font-family: 'Syne', sans-serif;
    font-size: 15px; font-weight: 800;
    background: linear-gradient(135deg, #fff 0%, var(--accent) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .brand-sub { font-size: 9px; color: var(--muted); margin-top: 1px; }

  .engine-badge {
    font-size: 9px;
    padding: 3px 8px;
    background: rgba(124,58,237,0.15);
    border: 1px solid rgba(124,58,237,0.3);
    border-radius: 10px;
    color: #a78bfa;
  }

  /* ‚îÄ‚îÄ‚îÄ EMAIL CARD ‚îÄ‚îÄ‚îÄ */
  .email-card {
    margin: 12px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 10px 12px;
    flex-shrink: 0;
  }

  .email-row { display: flex; gap: 8px; align-items: baseline; margin-bottom: 3px; }
  .email-row:last-child { margin-bottom: 0; }
  .email-key { font-size: 9px; text-transform: uppercase; letter-spacing: 0.15em; color: var(--muted); min-width: 40px; flex-shrink: 0; }
  .email-val { font-size: 11px; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1; }
  .email-val.accent { color: var(--accent); }

  /* ‚îÄ‚îÄ‚îÄ STATUS BAR ‚îÄ‚îÄ‚îÄ */
  .status-bar {
    margin: 0 12px 12px;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 11px;
    display: flex;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
    transition: all 0.3s;
  }

  .status-bar.drafting { background: rgba(245,158,11,0.08); border: 1px solid rgba(245,158,11,0.25); color: var(--amber); }
  .status-bar.ready    { background: rgba(0,229,255,0.06);  border: 1px solid rgba(0,229,255,0.2);  color: var(--accent); }
  .status-bar.error    { background: rgba(239,68,68,0.08);  border: 1px solid rgba(239,68,68,0.25); color: var(--red); }
  .status-bar.idle     { background: rgba(100,116,139,0.08);border: 1px solid rgba(100,116,139,0.15);color: var(--muted); }

  .status-spinner {
    width: 14px; height: 14px;
    border: 2px solid rgba(245,158,11,0.2);
    border-top-color: var(--amber);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    flex-shrink: 0;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* ‚îÄ‚îÄ‚îÄ DRAFT AREA ‚îÄ‚îÄ‚îÄ */
  .draft-section { flex: 1; display: flex; flex-direction: column; overflow: hidden; margin: 0 12px; }
  .draft-label { font-size: 9px; letter-spacing: 0.2em; text-transform: uppercase; color: var(--muted); margin-bottom: 6px; flex-shrink: 0; }

  .draft-textarea {
    flex: 1; width: 100%;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px; line-height: 1.75;
    padding: 12px; resize: none; outline: none;
    transition: border-color 0.15s;
    min-height: 120px;
  }
  .draft-textarea:focus { border-color: rgba(0,229,255,0.35); }
  .draft-textarea:disabled { opacity: 0.4; cursor: not-allowed; }

  /* ‚îÄ‚îÄ‚îÄ ACTIONS ‚îÄ‚îÄ‚îÄ */
  .actions {
    padding: 12px;
    display: flex; flex-direction: column; gap: 8px;
    flex-shrink: 0;
    border-top: 1px solid var(--border);
    margin-top: 12px;
  }

  .actions-row { display: flex; gap: 8px; }

  .btn {
    flex: 1; padding: 10px 14px; border-radius: 7px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px; font-weight: 600;
    cursor: pointer; border: 1px solid;
    transition: all 0.15s; text-align: center;
  }
  .btn:disabled { opacity: 0.45; cursor: not-allowed; }

  .btn-send { background: var(--green); color: #0a0a0f; border-color: var(--green); }
  .btn-send:hover:not(:disabled) { background: #34d399; box-shadow: 0 0 16px rgba(16,185,129,0.3); }

  .btn-regen { background: transparent; color: var(--muted); border-color: var(--border); }
  .btn-regen:hover:not(:disabled) { color: var(--text); border-color: var(--muted); }

  .btn-draft { background: var(--accent); color: #0a0a0f; border-color: var(--accent); }
  .btn-draft:hover:not(:disabled) { background: #33eaff; }

  .privacy-note { text-align: center; font-size: 10px; color: var(--subtle); padding-bottom: 4px; }

  /* ‚îÄ‚îÄ‚îÄ SENT ‚îÄ‚îÄ‚îÄ */
  .sent-view {
    flex: 1; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 12px; padding: 24px; text-align: center;
  }
  .sent-icon { font-size: 36px; color: var(--green); }
  .sent-title { font-family: 'Syne', sans-serif; font-size: 16px; font-weight: 800; color: var(--text); }
  .sent-sub { font-size: 11px; color: var(--muted); line-height: 1.6; }

  /* ‚îÄ‚îÄ‚îÄ ERROR ‚îÄ‚îÄ‚îÄ */
  .error-detail { font-size: 10px; color: var(--muted); line-height: 1.6; margin-top: 4px; }

  /* ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ */
  .hidden { display: none !important; }
</style>
</head>
<body>

<!-- Pin Banner ‚Äî shows on first open only -->
<div id="pin-banner">
  <div class="pin-icon">üìå</div>
  <div class="pin-text">
    <div class="pin-title">Pin MailMind to stay open</div>
    <div class="pin-desc">
      Click the <strong>pin icon</strong> in the top-right corner of this panel
      to keep MailMind open automatically every time you read an email.
      You'll only need to open it once.
    </div>
  </div>
  <button class="pin-dismiss" id="pin-dismiss">Got it</button>
</div>

<!-- Header -->
<div class="header">
  <div class="header-left">
    <div class="logo">‚ú¶</div>
    <div>
      <div class="brand-name">MailMind</div>
      <div class="brand-sub">AI Reply Assistant</div>
    </div>
  </div>
  <div class="engine-badge">Claude AI</div>
</div>

<!-- Email metadata -->
<div class="email-card">
  <div class="email-row">
    <span class="email-key">From</span>
    <span class="email-val accent" id="meta-from">Loading‚Ä¶</span>
  </div>
  <div class="email-row">
    <span class="email-key">Subject</span>
    <span class="email-val" id="meta-subject">‚Äî</span>
  </div>
</div>

<!-- Status bar -->
<div class="status-bar idle hidden" id="status-bar">
  <span id="status-icon"></span>
  <span id="status-text"></span>
</div>

<!-- Draft view -->
<div id="view-draft" class="hidden" style="flex:1;display:flex;flex-direction:column;overflow:hidden;">
  <div class="draft-section">
    <div class="draft-label">AI Draft ‚Äî review before sending</div>
    <textarea class="draft-textarea" id="draft-textarea" placeholder="Draft will appear here‚Ä¶"></textarea>
  </div>
  <div class="actions">
    <div class="actions-row">
      <button class="btn btn-regen" id="btn-regen">‚Ü∫ Regenerate</button>
      <button class="btn btn-send" id="btn-send">‚úì Open Reply</button>
    </div>
    <div class="privacy-note">‚ú¶ Drafted with Claude AI ¬∑ MailMind</div>
  </div>
</div>

<!-- Idle view -->
<div id="view-idle" style="flex:1;display:flex;flex-direction:column;padding:12px;gap:10px;">
  <div style="color:var(--muted);font-size:11px;line-height:1.7;padding:8px 0;">
    Open an email to automatically generate a draft reply, or click below to draft manually.
  </div>
  <button class="btn btn-draft" id="btn-manual-draft" style="flex:0">‚ú¶ Draft Reply Now</button>
  <div id="error-box" class="hidden" style="margin-top:8px;">
    <div style="color:var(--red);font-size:11px;font-weight:600;" id="error-title">Error</div>
    <div class="error-detail" id="error-detail"></div>
    <button class="btn btn-regen" id="btn-retry" style="margin-top:10px;flex:0;width:100%">‚Ü∫ Retry</button>
  </div>
</div>

<!-- Sending view -->
<div id="view-sending" class="hidden" style="flex:1;">
  <div class="sent-view">
    <div class="sent-icon">üì®</div>
    <div class="sent-title">Reply window open</div>
    <div class="sent-sub">Your draft is pre-filled and ready.<br>Just click <strong style="color:#e2e8f0">Send</strong> in the compose window to send.</div>
    <button class="btn btn-regen" id="btn-sending-back" style="margin-top:16px;width:100%">‚Üê Edit draft</button>
  </div>
</div>

<!-- Sent view -->
<div id="view-sent" class="hidden" style="flex:1;">
  <div class="sent-view">
    <div class="sent-icon">‚úì</div>
    <div class="sent-title">Reply Sent</div>
    <div class="sent-sub">Your reply was sent successfully.<br>MailMind is ready for the next email.</div>
    <button class="btn btn-regen" id="btn-after-sent" style="margin-top:8px;width:100%">‚Üê Back</button>
  </div>
</div>

<script src="taskpane.js"></script>
<script>
  // Pin banner ‚Äî show once, hide forever after dismiss
  const banner = document.getElementById('pin-banner');
  const dismissBtn = document.getElementById('pin-dismiss');

  // Check if already dismissed (stored in localStorage)
  if (localStorage.getItem('mailmind-pin-dismissed')) {
    banner.style.display = 'none';
  }

  dismissBtn.addEventListener('click', () => {
    localStorage.setItem('mailmind-pin-dismissed', '1');
    banner.style.height = banner.offsetHeight + 'px';
    banner.style.overflow = 'hidden';
    banner.style.transition = 'all 0.3s ease';
    requestAnimationFrame(() => {
      banner.style.height = '0';
      banner.style.padding = '0';
      banner.style.opacity = '0';
    });
    setTimeout(() => banner.style.display = 'none', 300);
  });
</script>
</body>
</html>
